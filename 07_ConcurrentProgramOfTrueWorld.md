# 真实世界的并发编程

## 高性能计算

## 数据中心和并发系统调用

如何用一台可靠的计算机尽可能多服务并行请求？

指标：QPS(每秒能完成的请求的数量)，tail latency(尾部延迟)

工具：

- 线程：切换时要保存所有的寄存器和栈
  - 可以充分利用多处理器，真正做到并行执行
  - 每个线程都会占用可观的操作系统资源
- 协程：切换的代价要小得多
  - 不需要调用操作系统的函数
  - 一个线程对应多个协程
  - co_yield()被翻译为一条call指令

### Go和Goroutine

- Go程序的“线程”实际上在运行协程
- 概念上是线程，实际上是线程和协程的混合体
- 成功：立即执行；失败：马上yield到另一个goroutine

## 浏览器和异步编程

- web 2.0:归功于浏览器的并行编程
- Ajax：`Asynchronous JavaScript` + `XML`

- tip:`vscode`就是一个浏览器

### 单线程+事件模型--异步事件模型

- 尽可能少但足够的并发
- 一个线程、全局的事件队列、按序执行
- 耗时的API(Timer,Ajax,...)调用会立即返回
- 条件满足时向队列里添加一个事件

优点

- 简化并发模型
- API可以并行